import{y as m,J as h}from"./index-B00xg2jH.js";import{_ as v,c as a,a as e,f as u,h as b,F,g as x,t as i,i as y,b as r,w as _,v as g,r as B,o as c,d as f}from"./index-DIsAfUU2.js";const E={data(){return{themes:[],selecttheme_name:"",selecttheme:"",selectedTheme:{theme_title:"你尚未设置主题！"},themeconfig:"",jsonthemeconfig:""}},created(){this.$axios.defaults.headers.common.Authorization="Token "+localStorage.getItem("token"),this.$axios.get("/hexo_theme").then(t=>{t.data==[]?this.themes=[{theme_name:"尚未添加主题"}]:this.themes=t.data,this.themes=t.data}).catch(t=>{}),this.$axios.get("/hexo_theme_config").then(t=>{t.data==null||(this.selectedTheme=t.data,this.themeconfig=m.dump(h.parse(t.data.config)))}).catch(t=>{})},mounted(){},methods:{jsonstotring(t){return t=t.replace(/(\w+)\s*:/g,'"$1":'),t=t.replace(/"http"/g,"http").replace(/"https"/g,"https"),t=t.replace(/"mailto":name@email.com/g,"mailto:name@email.com"),t=t.replace(/(\d{1,3})\.(\d{1,3})\.(\d{1,3})\."(\d{1,3})"/g,"$1.$2.$3.$4"),t=t.replace(/"HH":"mm":ss/g,"HH:mm:ss"),t=t.replace(/\'/g,'"'),t},updateThemeList(){this.$axios.get("/pull_hexo_theme").then(t=>{this.themes=t.data,console.log(this.themes)}).catch(t=>{})},useTheme(){this.$axios.get("/hexo_theme_config_set",{params:{theme_name:this.selecttheme_name}}).then(t=>{alert("设置成功！"),window.location.reload(),console.log(t.data)}).catch(t=>{console.log(t)})},parsethemeconfig(){try{this.jsonthemeconfig=this.jsonstotring(h.stringify(m.load(this.themeconfig),null,2))}catch{alert("yml配置存在问题！")}},updatethemeconfig(){this.parsethemeconfig(),this.$axios.post("/hexo_theme_config",{config:this.jsonstotring(h.stringify(m.load(this.jsonthemeconfig)))}).then(t=>{t.data.message!="success"?alert("保存失败:"+t.data.message):alert("配置已上传至服务器")}).catch(t=>{alert("保存失败:"+t)})}}},C={class:"container"},w={class:"mb-3"},T=e("label",{for:"themeSelect",class:"form-label"},"选择你想使用的主题：",-1),j=["value"],k={class:"card mb-3"},D={class:"card-body"},A=e("h5",{class:"card-title"},"主题详情",-1),V={class:"card mb-3"},H={class:"card-body d-flex flex-column"},S={key:0,class:"card-text"},N={class:"mt-auto d-grid gap-2"},L={class:"card mb-3"},U={class:"col-md-10 vh-100"},J={class:"row row-cols-1 row-cols-md-2 h-100 g-4"},M={class:"col"},W={class:"card h-100"},z={class:"card-body p-4 h-100"},G={class:"d-flex justify-content-between align-items-center"},I=e("div",{class:"fs-5"},"主题相关配置",-1),q=e("hr",{class:"my-3"},null,-1),K={class:"col"},O={class:"card h-100"},P={class:"card-body p-4"},Q={class:"d-flex justify-content-between align-items-center"},R=e("div",{class:"fs-5"},"yml配置json格式预览",-1),X=e("hr",{class:"my-3"},null,-1);function Y(t,s,Z,$,o,l){const d=B("router-link");return c(),a("div",C,[e("div",w,[T,u(e("select",{"onUpdate:modelValue":s[0]||(s[0]=n=>o.selecttheme_name=n),onChange:s[1]||(s[1]=n=>o.selecttheme=o.themes.find(p=>p.theme_name===o.selecttheme_name)),id:"themeSelect",class:"form-select"},[(c(!0),a(F,null,x(o.themes,n=>(c(),a("option",{value:n.theme_name},i(n.theme_name),9,j))),256))],544),[[b,o.selecttheme_name]]),e("button",{onClick:s[2]||(s[2]=n=>l.updateThemeList()),class:"btn btn-primary mt-2"},"更新主题列表")]),e("div",k,[e("div",D,[A,e("div",null,[e("p",null,"主题名称："+i(o.selecttheme.theme_name),1),e("p",null,"Git地址："+i(o.selecttheme.theme_url),1),e("p",null,"预览地址："+i(o.selecttheme.theme_preview_url),1)]),e("div",null,[e("button",{class:"btn btn-primary",onClick:s[3]||(s[3]=(...n)=>l.useTheme&&l.useTheme(...n))},"使用此主题")])])]),e("div",V,[e("div",H,[e("div",null,[o.selectedTheme.theme_title?(c(),a("p",S,"你目前使用的主题是："+i(o.selectedTheme.theme_title),1)):y("",!0)]),e("div",N,[r(d,{class:"btn btn-primary w-25",to:"/hexo_config"},{default:_(()=>[f("回到Hexo配置")]),_:1}),r(d,{class:"btn btn-secondary w-25",to:"/blogadmin"},{default:_(()=>[f("开始写博客")]),_:1})])])]),e("div",L,[e("div",U,[e("div",J,[e("div",M,[e("div",W,[e("div",z,[e("div",G,[I,e("div",null,[e("button",{class:"btn btn-primary",onClick:s[4]||(s[4]=n=>l.parsethemeconfig()),type:"button"}," 预览 ")])]),q,u(e("textarea",{class:"form-control h-75","aria-label":"With textarea",onChange:s[5]||(s[5]=n=>l.parsethemeconfig()),"onUpdate:modelValue":s[6]||(s[6]=n=>o.themeconfig=n)},null,544),[[g,o.themeconfig]])])])]),e("div",K,[e("div",O,[e("div",P,[e("div",Q,[R,e("div",null,[e("button",{class:"btn btn-primary",onClick:s[7]||(s[7]=n=>l.updatethemeconfig()),type:"button"}," 保存 ")])]),X,u(e("textarea",{class:"form-control h-75","aria-label":"With textarea","onUpdate:modelValue":s[8]||(s[8]=n=>o.jsonthemeconfig=n)},null,512),[[g,o.jsonthemeconfig]])])])])])])])])}const se=v(E,[["render",Y]]);export{se as default};
